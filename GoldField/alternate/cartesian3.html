<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
      #tooltip {
        position: absolute;
        margin: 5px;
        width: 200px;
        height: auto;
        border: 2px solid #0000ff;
        display: none;
        background-color: #A0A0ff;
        visible: hidden;
      }
    </style>
    <script src="goldfield.js"></script>
    <script src="cartesian.js"></script>
    <script>
      var ttips = {};
      
      function addToolTip(id,value)
      {
        ttips[id]=value;
      }
      
      addToolTip("object","OBJECT - Portions of software data and operations that are contained in one packet of software code.");
      
      function showTTip(ttID)
      {
        var tag = document.getElementById("tooltip");
        tag.innerHTML=ttips[ttID];
        var loc = document.getElementById(ttID);
        var rect = loc.getBoundingClientRect();
        tag.style.left = rect.left + window.scrollX + 5;
        tag.style.top = rect.top + window.scrollY + 5;
        tag.style.visible = "visible";
        tag.style.display = "block"
      }
      
      function hideTTip()
      {
        var tag = document.getElementById("tooltip");
        tag.innerHTML="empty";
        tag.style.visible = "hidden";
        tag.style.display = "none"
      }
      
      var goldField;
      var half = 9;
      var xCurr=0;
      var yCurr=0;
      var distance=0;

      function init()
      {
        blockWin = false;
        document.getElementById("nextLink").style.visibility="hidden"
        goldField = new GoldField(document.getElementById("field"),30, 2*half+1, 2*half+1);
        goldField.SetKeyListener(Key);

        yAxis = new YAxis()
        goldField.AddGenericLayer(yAxis);
        yAxis.SetLayerOn(true);

        xAxis = new XAxis()
        goldField.AddGenericLayer(xAxis);
        xAxis.SetLayerOn(true);

        grid = new Grid()
        goldField.AddGenericLayer(grid);
        grid.SetLayerOn(true);
        goldField.Redraw();

        hero = goldField.AddHero();
        xCurr = Math.floor(Math.random()*(2*half+1));
        yCurr = Math.floor(Math.random()*(2*half+1));
        targetX = Math.floor(Math.random()*(2*half+1));
        targetY = Math.floor(Math.random()*(2*half+1));
        while(xCurr==targetX && yCurr==targetY)
        {
          targetX = Math.floor(Math.random()*(2*half+1));
          targetY = Math.floor(Math.random()*(2*half+1));
          distance = Math.sqrt(((targetX-xCurr)*(targetX-xCurr))+((targetY-yCurr)*(targetY-yCurr)));
        }
        
        hero.SetPosition(xCurr,yCurr);
        xCurr-=half;
        yCurr-=half;

        document.getElementById("xPos").value=""+xCurr;
        document.getElementById("yPos").value=""+yCurr;
      }

      function Key(event)
      {
        //37 left arrow
        //38 up arrow
        //39 right arrow
        //40 down arrow

        var deltaX = 0;
        var deltaY = 0;
        if(event[0]==37)
        {
          deltaX = -1;
        }
        else if(event[0]==38)
        {
          deltaY = -1;
        }
        else if(event[0]==39)
        {
          deltaX = 1;
        }
        else if(event[0]==40)
        {
          deltaY = 1;
        }

        if(hero != null)
        {
           var dim = field.GetDimensions();
           var loc = hero.GetPosition();
           if(!(loc[0] + deltaX < 0 || loc[0] + deltaX == dim[0]))
           {
             loc[0] = loc[0]+deltaX;
           }

           if(!(loc[1] + deltaY < 0 || loc[1] + deltaY == dim[1]))
           {
             loc[1] = loc[1]+deltaY;
           }

           var nextSpace = field.LookAt(loc[0],loc[1]);
           if(nextSpace[0]==Empty)
           {
             hero.SetPosition(loc[0],loc[1]);
             xCurr=loc[0];
             yCurr=loc[1];
             checkWin();
           }
        }        
      }

      function checkWin()
      {
        if(blockWin)
        {
          return;//only one win at a time
        }
        blockWin = true;
        document.getElementById("xPos").value=""+(xCurr-half);
        document.getElementById("yPos").value=""+(yCurr-half);
         var d0 = distance;
         distance = Math.sqrt(((targetX-xCurr)*(targetX-xCurr))+((targetY-yCurr)*(targetY-yCurr)));

         if(distance==0)
         {
           document.getElementById("output").innerHTML="You got it!";
         }
         else if(d0-distance>0)
         {
           document.getElementById("output").innerHTML="Closer....";
         }
         else if(d0-distance>0)
         {
           document.getElementById("output").innerHTML="Nearer....";
         }
         else //relatively the same
         {
           document.getElementById("output").innerHTML="About th esame";
         }
         blockWin = false;
      }
      
      function newLocation()
      {
        xCurr=parseInt(document.getElementById("xPos").value)+half;
        yCurr=parseInt(document.getElementById("yPos").value)+half;
        hero.SetPosition(xCurr,yCurr);
        checkWin();
      }
    </script>
  </head>
  <body onload="init()">
    <table><tr><td>
      <canvas id="field"></canvas></td>
      <td>
        <p class="content">
          The Hero is an <em id="object" onmouseover="showTTip(this.id)" onmouseout="hideTTip()">object</em> that has its own variables for x and y position. Within the Hero object, <em>this</em> just means
          'this object'. So the Hero's location is always known as this.xPos and this.yPos. The Hero always knowns where it is using these
          variables. We can write out the position as a pair of values. In computers, this is called a <em>tuple</em>. This is the Hero's
          current position.
        </p>
        <p class="code">
          <br>
          (this.xPos, this.yPos) = (<input type="text" id="xPos" maxlength="2" size="2" onchange="newLocation()"></input>,<input type="text" id="yPos" maxlength="2" size="2" onchange="newLocation()"></input>) 
          <br>&nbsp;
        </p>
        <h2>Can You Find the Gold?</h2>
        <p class="content">
          There is a hidden gold bar in the field. Change the xPos and yPos above to search the space. You can also use the arrows.
          I'll let you know if you are further or nearer until you find it. 
        </p>
        <p id="output"></p>
        <p class="content">
          In GoldField, when the Hero moves it has to do three things:
          <table>
            <tr><td>Clear the last position from the field.</td><td><pre>field.spaces[this.xPos][this.yPos]=-1;</pre></td></tr>
            <tr><td>Update the Hero's own X and Y positions.</td><td></td></tr>
            <tr><td>Set the next position in the field.</td><td></td></tr>
          </table>
        </p>
        <a href="cartesian3.html" id="nextLink"><img src="nextbutton.png"></a>
      </td></tr>
    </table>
    <div id="tooltip">
    </div>
  </body>
</html>
