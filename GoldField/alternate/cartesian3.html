<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
    </style>
    <script src="goldfield.js"></script>
    <script src="cartesian.js"></script>
    <script>
      var goldField;
      var half = 4
      var xCurr=0;
      var yCurr=0;

      function init()
      {
        document.getElementById("nextLink").style.visibility="hidden"
        goldField = new GoldField(document.getElementById("field"),30, 2*half+1, 2*half+1);
        goldField.SetKeyListener(Key);

        yAxis = new YAxis()
        goldField.AddGenericLayer(yAxis);
        yAxis.SetLayerOn(true);

        xAxis = new XAxis()
        goldField.AddGenericLayer(xAxis);
        xAxis.SetLayerOn(true);

        grid = new Grid()
        goldField.AddGenericLayer(grid);
        grid.SetLayerOn(true);
        goldField.Redraw();

        hero = goldField.AddHero();
        xCurr = Math.floor(Math.Random()*(2*half+1));
        yCurr = Math.floor(Math.Random()*(2*half+1));
        hero.SetPosition(xCurr,yCurr);
        xCurr+=half;
        yCurr+=half;

        for(let e in document.getElementsByName("xPos"))
        {
          e.value=""+xCurr;
        }

        for(let e in document.getElementsByName("yPos"))
        {
          e.value=""+yCurr;
        }
      }

      function Key(event)
      {
        //37 left arrow
        //38 up arrow
        //39 right arrow
        //40 down arrow

        var deltaX = 0;
        var deltaY = 0;
        if(event[0]==37)
        {
          deltaX = -1;
        }
        else if(event[0]==38)
        {
          deltaY = -1;
        }
        else if(event[0]==39)
        {
          deltaX = 1;
        }
        else if(event[0]==40)
        {
          deltaY = 1;
        }

        if(hero != null)
        {
           var dim = field.GetDimensions();
           var loc = hero.GetPosition();
           if(!(loc[0] + deltaX < 0 || loc[0] + deltaX == dim[0]))
           {
             loc[0] = loc[0]+deltaX;
           }

           if(!(loc[1] + deltaY < 0 || loc[1] + deltaY == dim[1]))
           {
             loc[1] = loc[1]+deltaY;
           }

           var nextSpace = field.LookAt(loc[0],loc[1]);
           if(nextSpace[0]==Empty)
           {
             document.getElementById("output").innerHTML = "Hero at : ("+(loc[0]-half)+", "+(-(loc[1]-half))+")";
             hero.SetPosition(loc[0],loc[1]);
           }
        }
      }
    </script>
  </head>
  <body onload="init()">
    <table><tr><td>
      <canvas id="field"></canvas></td>
      <td>
        <p class="content">
          The Hero is an <em>object</em> that has its own variables for x and y position. Within the Hero object, <em>this</em> just means
          'this object'. So the Hero's location is always known as this.xPos and this.yPos. The Hero always knowns where it is using these
          variables. We can write out the position as a pair of values. In computers, this is called a <em>tuple</em>. This is the Hero's
          current position.
        </p>
        <p class="code">
          <br>
          (this.xPos, this.yPos) = (<input type="text" name="xPos"></input>,<input type="text" name="yPos"></input>) 
          <br>
        </p>
        <p class="content">
          In GoldField, when the Hero moves it has to do three things:
          <table>
            <tr><td>Clear the last position from the field.</td><td><pre>field.spaces[this.xPos][this.yPos]=-1;</pre></td></tr>
            <tr><td>Update the Hero's own X and Y positions.</td><td></td></tr>
            <tr><td>Set the next position in the field.</td><td></td></tr>
          </table>
        </p>
        <a href="cartesian3.html" id="nextLink"><img src="nextbutton.png"></a>
      </td></tr></table>
  </body>
</html>
