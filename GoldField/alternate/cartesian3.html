<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <style>
    </style>
    <script src="ttip.js"></script>
    <script src="goldfield.js"></script>
    <script src="cartesian.js"></script>
    <script>
      var goldField;
      var half = 10;
      var xCurr=0;
      var yCurr=0;
      var distance=0;
      var gold=0;
      
      function init()
      {
        blockWin = false;
        document.getElementById("nextLink").style.visibility="hidden"
        goldField = new GoldField(document.getElementById("field"),30, 2*half+1, 2*half+1);
        goldField.SetKeyListener(Key);

        yAxis = new YAxis()
        goldField.AddGenericLayer(yAxis);
        yAxis.SetLayerOn(true);

        xAxis = new XAxis()
        goldField.AddGenericLayer(xAxis);
        xAxis.SetLayerOn(true);

        grid = new Grid()
        goldField.AddGenericLayer(grid);
        grid.SetLayerOn(true);
        
        hero = goldField.AddHero();
        ResetBoard();
      }
     
      function ResetBoard()
      {
        document.getElementById("reset").style.visibility="hidden";
        xCurr = Math.floor(Math.random()*(2*half+1));
        yCurr = Math.floor(Math.random()*(2*half+1));
        targetX = Math.floor(Math.random()*(2*half+1));
        targetY = Math.floor(Math.random()*(2*half+1));
        distance = Math.sqrt(((targetX-xCurr)*(targetX-xCurr))+((targetY-yCurr)*(targetY-yCurr)));
        while(xCurr==targetX && yCurr==targetY)
        {
          targetX = Math.floor(Math.random()*(2*half+1));
          targetY = Math.floor(Math.random()*(2*half+1));
          distance = Math.sqrt(((targetX-xCurr)*(targetX-xCurr))+((targetY-yCurr)*(targetY-yCurr)));
        }
        
        //used for debug only
        //gold = goldField.AddGold();
        //gold.SetPosition(targetX, targetY);
        hero.SetPosition(xCurr,yCurr);
        xCurr-=half;
        yCurr=half-yCurr;

        document.getElementById("xPos").value=""+xCurr;
        document.getElementById("yPos").value=""+yCurr;
        goldField.Redraw();
      }

      function Key(event)
      {
        //37 left arrow
        //38 up arrow
        //39 right arrow
        //40 down arrow

        var deltaX = 0;
        var deltaY = 0;
        var anyArrow = false;
        if(event[0]==37)
        {
          deltaX = -1;
          anyArrow = true;
        }
        else if(event[0]==38)
        {
          deltaY = -1;
          anyArrow = true;
        }
        else if(event[0]==39)
        {
          deltaX = 1;
          anyArrow = true;
        }
        else if(event[0]==40)
        {
          deltaY = 1;
          anyArrow = true;
        }

        if(hero != null && anyArrow)
        {
          var dim = field.GetDimensions();
          var loc = hero.GetPosition();
          if(deltaX != 0 && !(loc[0] + deltaX < 0 || loc[0] + deltaX == dim[0]))
          {
            loc[0] = loc[0]+deltaX;
          }
          
          if(deltaY != 0 && !(loc[1] + deltaY < 0 || loc[1] + deltaY == dim[1]))
          {
            loc[1] = loc[1]+deltaY;
          }
          
          var nextSpace = field.LookAt(loc[0],loc[1]);
          if(nextSpace[0]!=Empty)
          {
            goldField.PlaySound("coin");
          }
          
          if(nextSpace[0]==Empty)
          {
            hero.SetPosition(loc[0],loc[1]);
            xCurr=loc[0];
            yCurr=loc[1];
            goldField.Redraw();
            checkWin();
          }
        }        
      }
      
      function newLocation()
      {
        tx = parseInt(document.getElementById("xPos").value);
        xCurr=tx+half;
        ty = parseInt(document.getElementById("yPos").value);
        yCurr=ty+half;
        hero.SetPosition(xCurr, yCurr);
        goldField.Redraw();
        checkWin();
      }

      function checkWin()
      {
        if(blockWin)
        {
          return;//only one win at a time
        }
        blockWin = true;
        document.getElementById("xPos").value=""+(xCurr-half);
        document.getElementById("yPos").value=""+(half-yCurr);
         var d0 = distance;
        
         distance = Math.sqrt(((targetX-xCurr)*(targetX-xCurr))+((targetY-yCurr)*(targetY-yCurr)));

         if(distance==0)
         {
           document.getElementById("output").innerHTML="You got it!";
           goldField.PlaySound("coin");
           document.getElementById("reset").style.visibility="visible";
           document.getElementById("nextLink").style.visibility="visible"
         }
         else if(d0-distance>0)
         {
           document.getElementById("output").innerHTML="Closer....";
         }
         else if(d0-distance<0)
         {
           document.getElementById("output").innerHTML="Farther....";
         }
         else //relatively the same
         {
           document.getElementById("output").innerHTML="About the same";
         }
         blockWin = false;
      }
    </script>
  </head>
  <body onload="init()">
    <table><tr><td>
      <canvas id="field"></canvas></td>
      <td class="top">
        <p class="content">
          The Hero is an <span class="ttip" id="object" onmouseover="showTTip(this.id)" onmouseout="hideTTip()">object</span> that has its own <span class="ttip" id="variable" onmouseover="showTTip(this.id)" onmouseout="hideTTip()">variable</span>s for x and y position. Within the Hero object, the <span class="ttip" id="keyword" onmouseover="showTTip(this.id)" onmouseout="hideTTip()">keyword</span> <em>this</em> just means
          'this object'. So the Hero's location is always known as this.xPos and this.yPos. The Hero always knows where it is using these variables. We can write out the position as a pair of x and y values. For historical reasons, mathematicians call this an <span class="ttip" id="ordered pair" onmouseover="showTTip(this.id)" onmouseout="hideTTip()">ordered pair</span>. In computers, this is called a <span class="ttip" id="tuple" onmouseover="showTTip(this.id)" onmouseout="hideTTip()">tuple</span>. 
          This is the Hero's current position.
        </p>
        <p class="code">
          <br>
          (this.xPos, this.yPos) = (<input type="text" id="xPos" maxlength="2" size="2" onchange="newLocation()"></input>,<input type="text" id="yPos" maxlength="2" size="2" onchange="newLocation()"></input>) 
          <br>&nbsp;
        </p>
        <h2>Can You Find the Gold?</h2>
        <p class="content">
          This is the Gold Field! Somewhere in the field is a hidden gold bar. You can use the arrow keys or the xPos and yPos above to search for it.
          I'll let you know if you are further or nearer until you find it. 
        </p>
        <p id="output"></p>
        <a href="cartesian3m.html" id="nextLink"><img src="nextbutton.png"></a><br>
        <button id="reset" onclick='ResetBoard()'>Try again</button><br>
      </td></tr>
    </table>
    <div id="tooltip">
    </div>
  </body>
</html>
