<html>
  <head>
    <style>
      canvas { width: 100%; height: 100% }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.js"></script>
    <script src="utils.js"></script>
    <script>
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
      var renderer = new THREE.WebGLRenderer();
      loadTextures();

      function load()
      {
        camera.position.y-=5;
        camera.position.z=50;
        renderer.setSize(window.innerWidth*.9, window.innerHeight*.9);
        document.body.appendChild(renderer.domElement);
        document.addEventListener("keydown", key, false);

        createBackground();

        var level = -10;
        var height = 8.5;
        var length = 40;
        var width = 8;

        var farLeft = -20;
        var farRight = 20;
        var front = 20;
        var back = -20;

        //8ft w x 8.5ft h x 40ft l
        scene.add(drawPanel(farLeft,level,back-width,farRight,level+.25,front,"foundation"));
        level += .35;
        var margin=.1;

        //left wall
        scene.add(drawPanel(farLeft,level,back,farLeft,level+height,front,"ext"));
        for(let i=0;i<5;i++)
        {//interior of same
          scene.add(drawPanel(farLeft+margin,level,back+(i*width),farLeft+margin,level+height,back+((i+1)*width),"int"));
        }

        //interior partitions
        scene.add(drawPanel(farLeft+width,level,back,farLeft+width+(margin*2),level+height,back+width,"int"));
        scene.add(drawPanel(farLeft+width,level,back+(3*width/2),farLeft+width+(margin*2),level+height,back+width,"int"));
        scene.add(drawPanel(farLeft+width,level,front-width,farLeft+width+(margin*2),level+height,front-(2*width),"int"));
        scene.add(drawPanel(farLeft+width,level,front-(5*width/2),farLeft+width+(margin*2),level+height,front-(2*width),"int"));

        //remnant of back wall and side of other box
        scene.add(drawPanel(farLeft+width,level,back,farLeft+(3*width/2),level+height,back+(margin*2),"int"));
        scene.add(drawPanel(farLeft+width,level,front-width,farLeft+(3*width/2),level+height,front-width+(margin*2),"int"));

        //front wall
        scene.add(drawPanel(farLeft,level,front,farLeft+width,level+height,front,"doors"));
        scene.add(drawPanel(farLeft,level,front-margin,farLeft+width,level+height,front-margin,"int"));

        //top of box
        scene.add(drawPanel(farLeft,level+height,front,farLeft+width,level+height,back,"top"));

        //right wall
        scene.add(drawPanel(farRight,level,back,farRight,level+height,front,"ext"));
        for(let i=0;i<5;i++)
        {//interior of same
          scene.add(drawPanel(farRight-margin,level,back+(i*width),farRight-margin,level+height,back+((i+1)*width),"int"));
        }

        //interior partitions
        scene.add(drawPanel(farRight-width,level,back,farRight-width+(margin*2),level+height,back+width,"int"));
        scene.add(drawPanel(farRight-width,level,back+(3*width/2),farRight-width+(margin*2),level+height,back+width,"int"));
        scene.add(drawPanel(farRight-width,level,front-width,farRight-width+(margin*2),level+height,front-(2*width),"int"));
        scene.add(drawPanel(farRight-width,level,front-(5*width/2),farRight-width+(margin*2),level+height,front-(2*width),"int"));

        //remains of back wall
        scene.add(drawPanel(farRight-width,level,back,farRight-(3*width/2),level+height,back+(margin*2),"int"));
        scene.add(drawPanel(farRight-width,level,front-width,farRight-(3*width/2),level+height,front-width+(margin*2),"int"));

        //front wall
        scene.add(drawPanel(farRight,level,front,farRight-width,level+height,front,"doors"));
        scene.add(drawPanel(farRight,level,front-margin,farRight-width,level+height,front-margin,"int"));

        //top of box
        scene.add(drawPanel(farRight,level+height,back,farRight-width,level+height,front,"top"));

        //back panel
        scene.add(drawPanel(farLeft,level,back-width,farRight,level+height,back-width,"ext"));
        for(let i=0;i<5;i++)
        {//interior of the same
          scene.add(drawPanel(farLeft+(i*width),level,back-width+margin,farLeft+((i+1)*width),level+height,back-width+margin,"int"));

          //wood along main floor
          scene.add(drawPanel(farLeft+(i*width),level,front,farLeft+((i+1)*width),level,back,"floor"));
        }

        //floor
        scene.add(drawPanel(farLeft,level,back-width,farRight,level,back,"floorH"));

        //sealed left and right doors
        scene.add(drawPanel(farLeft,level,back-width,farLeft,level+height,back,"doors"));
        scene.add(drawPanel(farRight,level,back-width,farRight,level+height,back,"doors"));
        scene.add(drawPanel(farLeft+margin,level,back-width,farLeft+margin,level+height,back,"int"));
        scene.add(drawPanel(farRight-margin,level,back-width,farRight-margin,level+height,back,"int"));

        //top of box
        scene.add(drawPanel(farLeft,level+height,back-width,farRight,level+height,back,"topH"));

        //bottom of box in the front
        scene.add(drawPanel(farLeft,level+height,front-width,farRight,level+height,front,"topH"));

        //front doors
        var windowSize = (length-(2*width))/3;
        var windowMargin = .1;
        drawWindow(farLeft+width,level,front-windowMargin,farLeft+width+windowSize,level+height,front+windowMargin);
        drawWindow(farRight-width,level,front-windowMargin,farRight-width-windowSize,level+height,front+windowMargin);

        //next floor
        level += height;

        //back top panel
        scene.add(drawPanel(farLeft,level,back-width,farRight,level+height,back-width,"ext"));
        for(let i=0;i<5;i++)
        {//interior of the same
          scene.add(drawPanel(farLeft+(i*width),level,back-width+margin,farLeft+((i+1)*width),level+height,back-width+margin,"int"));
          if(i>0&&i<4)
          {
            scene.add(drawPanel(farLeft+(i*width),level,back+margin,farLeft+((i+1)*width),level+height,back,"int"));
          }
        }

        //floor
        scene.add(drawPanel(farLeft,level+margin,back-width,farRight,level+margin,back,"floorH"));

        //sealed left/right doors
        scene.add(drawPanel(farLeft,level,back-width,farLeft,level+height,back,"doors"));
        scene.add(drawPanel(farRight,level,back-width,farRight,level+height,back,"doors"));
        scene.add(drawPanel(farLeft+margin,level,back-width,farLeft+margin,level+height,back,"int"));
        scene.add(drawPanel(farRight-margin,level,back-width,farRight-margin,level+height,back,"int"));

        //top of panel
        scene.add(drawPanel(farLeft,level+height,back-width,farRight,level+height,back,"topH"));

        //front top panel
        scene.add(drawPanel(farLeft,level,front,farRight,level+height,front,"ext"));
        for(let i=0;i<5;i++)
        {//interior of the same and front wall
          scene.add(drawPanel(farLeft+(i*width),level,front-margin,farLeft+((i+1)*width),level+height,front-margin,"int"));
          if(i>0&&i<4)
          {
            scene.add(drawPanel(farLeft+(i*width),level,front-width-margin,farLeft+((i+1)*width),level+height,front-width-margin,"int"));
          }
        }

        //floor
        scene.add(drawPanel(farLeft,level+margin,front-width,farRight,level+margin,front,"floorH"));

        //sealed left/right doors
        scene.add(drawPanel(farLeft,level,front-width,farLeft,level+height,front,"doors"));
        scene.add(drawPanel(farRight,level,front-width,farRight,level+height,front,"doors"));
        scene.add(drawPanel(farLeft+margin,level,front-width,farLeft+margin,level+height,front,"int"));
        scene.add(drawPanel(farRight-margin,level,front-width,farRight-margin,level+height,front,"int"));

        //box top
        scene.add(drawPanel(farLeft,level+height,front-width,farRight,level+height,front,"topH"));

        //windows on both sides
        for(let i=0;i<4;i++)
        {
          drawWindow(farLeft,level,front-width-(i*windowSize), farLeft+windowMargin,level+height,front-width-((i+1)*windowSize));
          drawWindow(farLeft+width,level,front-width-(i*windowSize), farLeft+width+windowMargin,level+4,front-width-((i+1)*windowSize));
          if(i<3)
          {
            drawWindow(farRight-width,level,front-width-(i*windowSize), farRight-width+windowMargin,level+4,front-width-((i+1)*windowSize));
          }
          drawWindow(farRight,level,front-width-(i*windowSize), farRight+windowMargin,level+height,front-width-((i+1)*windowSize));
        }
        drawWindow(farRight-width,level,back+(windowSize/2), farRight-width+windowMargin,level+4,back+width+windowSize);

        //floors on walkways
        scene.add(drawPanel(farLeft,level+margin,back,farLeft+width,level+margin,front,"floor"));
        scene.add(drawPanel(farRight,level+margin,back,farRight-width,level+margin,front,"floor"));

        //wall against stairs
        scene.add(drawPanel(farRight-width-4,level,back+windowSize/2,farRight-width-4,level-height,back+(3*windowSize/2),"int"));
        scene.add(drawPanel(farRight-width-4,level,back+windowSize/2,farRight-width-4,level-2,back,"int"));
        drawWindow(farRight-width-4,level,back+windowSize/2,farRight-width-4,level+4,back+(3*windowSize/2));
        drawWindow(farRight-width-4,level,back+windowSize/2,farRight-width-4,level+4,back,"int");

        //roof
        var v1 = new THREE.Vector3(farRight,level+height,back);
        var v2 = new THREE.Vector3(farRight,level+height,front);
        var v3 = new THREE.Vector3((farRight+farLeft)/2,level+(3*height/2),front-(3*width/2));
        var v4 = new THREE.Vector3((farRight+farLeft)/2,level+(3*height/2),back+(3*width/2));

        var geom = new THREE.Geometry(); 
        geom.vertices.push(v1);
        geom.vertices.push(v2);
        geom.vertices.push(v3);
        geom.vertices.push(v4);
        geom.faces.push( new THREE.Face3( 0, 1, 2));
        geom.faces.push( new THREE.Face3( 3, 0, 2));
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 0),
                                    new THREE.Vector2(1, 0),
                                    new THREE.Vector2(.7, 1)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(.3, 1),
                                    new THREE.Vector2(0, 0),
                                    new THREE.Vector2(1, 1)]);
        var object = new THREE.Mesh( geom, textures["shingles"] );
        scene.add(object);

        var v3 = new THREE.Vector3((farRight+farLeft)/2,level+(3*height/2),front-(3*width/2));
        var v4 = new THREE.Vector3((farRight+farLeft)/2,level+(3*height/2),back+(3*width/2));
        var v5 = new THREE.Vector3(farLeft,level+height,back);
        var v6 = new THREE.Vector3(farLeft,level+height,front);
        geom = new THREE.Geometry(); 
        geom.vertices.push(v3);
        geom.vertices.push(v4);
        geom.vertices.push(v5);
        geom.vertices.push(v6);
        geom.faces.push( new THREE.Face3( 0, 1, 2 ) );
        geom.faces.push( new THREE.Face3( 3, 0, 2 ) );
        geom.faceVertexUvs[0].push([new THREE.Vector2(.3, 1),
                                    new THREE.Vector2(.7, 1),
                                    new THREE.Vector2(1, 0)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 0),
                                    new THREE.Vector2(.3, 1),
                                    new THREE.Vector2(1, 0)]);
        object = new THREE.Mesh( geom, textures["shingles"] );
        scene.add(object);

        var v1 = new THREE.Vector3(farRight,level+height,back);
        var v4 = new THREE.Vector3((farRight+farLeft)/2,level+(3*height/2),back+(3*width/2));
        var v5 = new THREE.Vector3(farLeft,level+height,back);
        geom = new THREE.Geometry(); 
        geom.vertices.push(v1);
        geom.vertices.push(v4);
        geom.vertices.push(v5);
        geom.faces.push( new THREE.Face3( 0, 1, 2 ) );
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 0),
                                    new THREE.Vector2(.5, 1),
                                    new THREE.Vector2(1, 0)]);
        object = new THREE.Mesh( geom, textures["shingles"] );
        scene.add(object);

        var v2 = new THREE.Vector3(farRight,level+height,front);
        var v3 = new THREE.Vector3((farRight+farLeft)/2,level+(3*height/2),front-(3*width/2));
        var v6 = new THREE.Vector3(farLeft,level+height,front);
        geom = new THREE.Geometry(); 
        geom.vertices.push(v2);
        geom.vertices.push(v3);
        geom.vertices.push(v6);
        geom.faces.push( new THREE.Face3( 0, 1, 2 ) );
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 0),
                                    new THREE.Vector2(.5, 1),
                                    new THREE.Vector2(1, 0)]);
        object = new THREE.Mesh( geom, textures["shingles"] );
        scene.add(object);

        var v1 = new THREE.Vector3(farRight-width,level,back);
        var v2 = new THREE.Vector3(farRight-width-4,level,back);
        var v3 = new THREE.Vector3(farRight-width,level,back+windowSize/2);
        var v4 = new THREE.Vector3(farRight-width-4,level,back+windowSize/2);
        var v5 = new THREE.Vector3(farRight-width,level-height,back+(3*windowSize/2));
        var v6 = new THREE.Vector3(farRight-width-4,level-height,back+(3*windowSize/2));

        var geom = new THREE.Geometry(); 
        geom.vertices.push(v1);
        geom.vertices.push(v2);
        geom.vertices.push(v3);
        geom.vertices.push(v4);
        geom.vertices.push(v5);
        geom.vertices.push(v6);
        geom.faces.push( new THREE.Face3( 0, 1, 2 ) );
        geom.faces.push( new THREE.Face3( 1, 2, 3 ) );
        geom.faces.push( new THREE.Face3( 2, 3, 4 ) );
        geom.faces.push( new THREE.Face3( 3, 4, 5 ) );
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 0),
                                    new THREE.Vector2(.3, 0),
                                    new THREE.Vector2(0, .2)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(.3, 0),
                                    new THREE.Vector2(0, .2),
                                    new THREE.Vector2(.3, .2)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, .2),
                                    new THREE.Vector2(.3, .2),
                                    new THREE.Vector2(0, 1)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(.3, .2),
                                    new THREE.Vector2(0, 1),
                                    new THREE.Vector2(.3, 1)]);
        var object = new THREE.Mesh( geom, textures["floor"] );
        scene.add(object);

        scene.add(makeStove(-4,-10,back-width));
        scene.add(makeFridge(-8,-10,back-width));
        scene.add(makeSink(0,-6,front+20));

        var render = function () {
            requestAnimationFrame(render);
            renderer.render(scene, camera);
            };

        render();
      }

      function makeSink(x,y,z)
      {
        texture = makeMaterial("sink.png",false,false);
        var in3 = .4;
        var v0 = new THREE.Vector3(x,y,z);
        var v1 = new THREE.Vector3(x,y,z+5+(5*in3/2));
        var v2 = new THREE.Vector3(x+2,y,z+5+(5*in3/2));
        var v3 = new THREE.Vector3(x+2,y,z);

        var uv0 = new THREE.Vector3(0,1);
        var uv1 = new THREE.Vector3(1,1);
        var uv2 = new THREE.Vector3(1,0);
        var uv3 = new THREE.Vector3(0,0);

        var w = 748.0;
        var h = 296.0;
        var dep1 = -.2;
        var dep2 = -1.2;
        var d1 = new THREE.Vector3(x+in3,y,z+in3);
        var d2 = new THREE.Vector3(x+in3,y+dep1,z+1.5);
        var d3 = new THREE.Vector3(x+(3*in3/2),y+dep1,z+1.5+(in3/2));
        var d4 = new THREE.Vector3(x+2-(3*in3/2),y+dep1,z+1.5+(in3/2));
        var d5 = new THREE.Vector3(x+2-in3,y+dep1,z+1.5);
        var d6 = new THREE.Vector3(x+2-in3,y,z+in3);

        var uv_4 = new THREE.Vector3(22/w,(h-13)/h);
        var uv_5 = new THREE.Vector3(229/w,(h-13)/h);
        var uv_6 = new THREE.Vector3(282/w,(h-59)/h);
        var uv_7 = new THREE.Vector3(282/w,(h-235)/h);
        var uv_8 = new THREE.Vector3(229/w,(h-271)/h);
        var uv_9 = new THREE.Vector3(22/w,(h-271)/h);

        var s1 = new THREE.Vector3(x+in3,y+dep1,z+1.5+(2*in3));
        var s2 = new THREE.Vector3(x+in3,y+dep1,z+3.5+in3);
        var s3 = new THREE.Vector3(x+(3*in3/2),y+dep1,z+3.5+(3*in3/2));
        var s4 = new THREE.Vector3(x+2-(3*in3/2),y+dep1,z+3.5+(3*in3/2));
        var s5 = new THREE.Vector3(x+2-in3,y+dep1,z+3.5+in3);
        var s6 = new THREE.Vector3(x+2-in3,y+dep1,z+1.5+(2*in3));

        var uv_10 = new THREE.Vector3(329/w,13/h);
        var uv_11 = new THREE.Vector3(449/w,13/h);
        var uv_12 = new THREE.Vector3(491/w,59/h);
        var uv_13 = new THREE.Vector3(491/w,235/h);
        var uv_14 = new THREE.Vector3(449/w,271/h);
        var uv_15 = new THREE.Vector3(329/w,271/h);

        var b1 = new THREE.Vector3(x+(3*in3/2),y+dep2,z+1.5+(3*in3/2));
        var b2 = new THREE.Vector3(x+(3*in3/2),y+dep2,z+3.5+in3);
        var b3 = new THREE.Vector3(x+2-(3*in3/2),y+dep2,z+3.5+in3);
        var b4 = new THREE.Vector3(x+2-(3*in3/2),y+dep2,z+1.5+(2*in3));

        var uv_16 = new THREE.Vector3(329/w,59/h);
        var uv_17 = new THREE.Vector3(449/w,59/h);
        var uv_18 = new THREE.Vector3(449/w,235/h);
        var uv_19 = new THREE.Vector3(329/w,235/h);

        var r1 = new THREE.Vector3(x+(3*in3/2),y+dep1,z+3.5+(2*in3));
        var r2 = new THREE.Vector3(x+in3,y+dep1,z+3.5+(5*in3/2));
        var r3 = new THREE.Vector3(x+in3,y+dep1,z+5+(3*in3/2));
        var r4 = new THREE.Vector3(x+(3*in3/2),y+dep1,z+5+(2*in3));
        var r5 = new THREE.Vector3(x+2-(3*in3/2),y+dep1,z+5+(2*in3));
        var r6 = new THREE.Vector3(x+2-in3,y+dep1,z+5+(3*in3/2));
        var r7 = new THREE.Vector3(x+2-in3,y+dep1,z+3.5+(5*in3/2));
        var r8 = new THREE.Vector3(x+2-(3*in3/2),y+dep1,z+3.5+(2*in3));

        var uv_20 = new THREE.Vector3(514/w,59/h);
        var uv_21 = new THREE.Vector3(550/w,13/h);
        var uv_22 = new THREE.Vector3(682/w,13/h);
        var uv_23 = new THREE.Vector3(724/w,59/h);
        var uv_24 = new THREE.Vector3(724/w,235/h);
        var uv_25 = new THREE.Vector3(682/w,271/h);
        var uv_26 = new THREE.Vector3(550/w,271/h);
        var uv_27 = new THREE.Vector3(514/w,235/h);

        var c1 = new THREE.Vector3(x+(3*in3/2),y+dep2,z+3.5+(5*in3/2));
        var c2 = new THREE.Vector3(x+(3*in3/2),y+dep2,z+5+(3*in3/2));
        var c3 = new THREE.Vector3(x-(3*in3/2),y+dep2,z+5+(3*in3/2));
        var c4 = new THREE.Vector3(x-(3*in3/2),y+dep2,z+3.5+(5*in3/2));

        var uv_28 = new THREE.Vector3(550/w,59/h);
        var uv_29 = new THREE.Vector3(682/w,59/h);
        var uv_30 = new THREE.Vector3(682/w,235/h);
        var uv_31 = new THREE.Vector3(550/w,235/h);

        var geom = new THREE.Geometry(); 
        geom.vertices.push(v0);
        geom.vertices.push(v1);
        geom.vertices.push(v2);
        geom.vertices.push(v3);
        geom.vertices.push(d1);//4
        geom.vertices.push(d2);//5
        geom.vertices.push(d3);//6
        geom.vertices.push(d4);//7
        geom.vertices.push(d5);//8
        geom.vertices.push(d6);//9
        geom.vertices.push(s1);//10
        geom.vertices.push(s2);//11
        geom.vertices.push(s3);//12
        geom.vertices.push(s4);//13
        geom.vertices.push(s5);//14
        geom.vertices.push(s6);//15
        geom.vertices.push(b1);//16
        geom.vertices.push(b2);//17
        geom.vertices.push(b3);//18
        geom.vertices.push(b4);//19
        geom.vertices.push(r1);//20
        geom.vertices.push(r2);//21
        geom.vertices.push(r3);//22
        geom.vertices.push(r4);//23
        geom.vertices.push(r5);//24
        geom.vertices.push(r6);//25
        geom.vertices.push(r7);//26
        geom.vertices.push(r8);//27
        geom.vertices.push(c1);//28
        geom.vertices.push(c2);//29
        geom.vertices.push(c3);//30
        geom.vertices.push(c4);//31

        geom.faces.push( new THREE.Face3( 0, 4, 3 ) );
        geom.faces.push( new THREE.Face3( 4, 3, 9 ) );
        geom.faces.push( new THREE.Face3( 4, 5, 9 ) );
        geom.faces.push( new THREE.Face3( 5, 6, 9 ) );
        geom.faces.push( new THREE.Face3( 6, 8, 9 ) );
        geom.faces.push( new THREE.Face3( 6, 7, 8 ) );
        geom.faces.push( new THREE.Face3( 3, 8, 9 ) );
        geom.faces.push( new THREE.Face3( 6, 7, 16) );
        geom.faces.push( new THREE.Face3( 6, 16, 10) );
        geom.faces.push( new THREE.Face3( 16, 10, 11) );
        geom.faces.push( new THREE.Face3( 16, 11, 17) );
        geom.faces.push( new THREE.Face3( 5, 6, 10) );
        geom.faces.push( new THREE.Face3( 0, 4, 1 ) );
        geom.faces.push( new THREE.Face3( 4, 5, 1 ) );
        geom.faces.push( new THREE.Face3( 5, 10, 1) );
        //geom.faces.push( new THREE.Face3( 10, 11, 1) );
        //geom.faces.push( new THREE.Face3( 11, 21, 1) );
        //geom.faces.push( new THREE.Face3( 21, 22, 1) );

        geom.faceVertexUvs[0].push([uv0,uv_4,uv3]);
        geom.faceVertexUvs[0].push([uv_4,uv3,uv_9]);
        geom.faceVertexUvs[0].push([uv_4,uv_5,uv_9]);
        geom.faceVertexUvs[0].push([uv_5,uv_6,uv_9]);
        geom.faceVertexUvs[0].push([uv_6,uv_8,uv_9]);
        geom.faceVertexUvs[0].push([uv_6,uv_7,uv_8]);
        geom.faceVertexUvs[0].push([uv3,uv_8,uv_9]);
        geom.faceVertexUvs[0].push([uv_6,uv_7,uv_16]);
        geom.faceVertexUvs[0].push([uv_6,uv_16,uv_10]);
        geom.faceVertexUvs[0].push([uv_16,uv_10,uv_11]);
        geom.faceVertexUvs[0].push([uv_16,uv_11,uv_17]);
        geom.faceVertexUvs[0].push([uv_5,uv_6,uv_10]);
        geom.faceVertexUvs[0].push([uv0,uv_4,uv1]);
        geom.faceVertexUvs[0].push([uv_4,uv_5,uv1]);
        geom.faceVertexUvs[0].push([uv_5,uv_10,uv1]);
        //geom.faceVertexUvs[0].push([uv_10,uv_11,uv1]);
        //geom.faceVertexUvs[0].push([uv_11,uv_21,uv1]);
        //geom.faceVertexUvs[0].push([uv_21,uv_22,uv1]);

        var object = new THREE.Mesh( geom, texture );
        return object;
      }

      function makeStove(x,y,z)
      {
        texture = makeMaterial("stove2.png",false,false);
        var top = 3;
        var v0 = new THREE.Vector3(x,y+top,z);
        var v1 = new THREE.Vector3(x+3,y+top,z);
        var v2 = new THREE.Vector3(x,y+top,z+3);
        var v3 = new THREE.Vector3(x+3,y+top,z+3);
        var v4 = new THREE.Vector3(x,y,z+3);
        var v5 = new THREE.Vector3(x+3,y,z+3);
        var v6 = new THREE.Vector3(x,y,z);
        var v7 = new THREE.Vector3(x+3,y,z);

        var uv1 = new THREE.Vector3(0,1);
        var uv2 = new THREE.Vector3(308/701.0,1);
        var uv3 = new THREE.Vector3(0,0);
        var uv4 = new THREE.Vector3(308/701.0,0);
        var uvS1 = new THREE.Vector3(308/701.0,104/343.0);
        var uvS2 = new THREE.Vector3(1,104/361.0);
        var uvS3 = new THREE.Vector3(308/701.0,0);
        var uvS4 = new THREE.Vector3(1,0);

        var geom = new THREE.Geometry(); 
        geom.vertices.push(v0);
        geom.vertices.push(v1);
        geom.vertices.push(v2);
        geom.vertices.push(v3);
        geom.vertices.push(v4);
        geom.vertices.push(v5);
        geom.vertices.push(v6);
        geom.vertices.push(v7);
        geom.faces.push( new THREE.Face3( 0, 1, 2 ) );
        geom.faces.push( new THREE.Face3( 1, 2, 3 ) );
        geom.faces.push( new THREE.Face3( 2, 3, 4 ) );
        geom.faces.push( new THREE.Face3( 3, 4, 5 ) );
        geom.faces.push( new THREE.Face3( 0, 2, 6 ) );
        geom.faces.push( new THREE.Face3( 2, 6, 4 ) );
        geom.faces.push( new THREE.Face3( 3, 1, 5 ) );
        geom.faces.push( new THREE.Face3( 1, 5, 7 ) );
        geom.faceVertexUvs[0].push([uvS1,uvS2,uvS3]);
        geom.faceVertexUvs[0].push([uvS2,uvS3,uvS4]);

        geom.faceVertexUvs[0].push([uv1,uv2,uv3]);
        geom.faceVertexUvs[0].push([uv2,uv3,uv4]);

        geom.faceVertexUvs[0].push([uvS1,uvS2,uvS3]);
        geom.faceVertexUvs[0].push([uvS2,uvS3,uvS4]);
        geom.faceVertexUvs[0].push([uvS1,uvS2,uvS3]);
        geom.faceVertexUvs[0].push([uvS2,uvS3,uvS4]);

        var object = new THREE.Mesh( geom, texture );
        return object;
      }

      function makeFridge(x,y,z)
      {
        texture = makeMaterial("fridge.png",false,false);
        var v0 = new THREE.Vector3(x,y+6,z);
        var v1 = new THREE.Vector3(x,y,z);
        var v2 = new THREE.Vector3(x,y+6,z+3);
        var v3 = new THREE.Vector3(x,y,z+3);
        var v4 = new THREE.Vector3(x+4,y+6,z+3);
        var v5 = new THREE.Vector3(x+4,y,z+3);
        var v6 = new THREE.Vector3(x+4,y+6,z);
        var v7 = new THREE.Vector3(x+4,y,z);

        var geom = new THREE.Geometry(); 
        geom.vertices.push(v0);
        geom.vertices.push(v1);
        geom.vertices.push(v2);
        geom.vertices.push(v3);
        geom.vertices.push(v4);
        geom.vertices.push(v5);
        geom.vertices.push(v6);
        geom.vertices.push(v7);
        geom.faces.push( new THREE.Face3( 0, 1, 2 ) );
        geom.faces.push( new THREE.Face3( 1, 2, 3 ) );
        geom.faces.push( new THREE.Face3( 2, 3, 4 ) );
        geom.faces.push( new THREE.Face3( 3, 4, 5 ) );
        geom.faces.push( new THREE.Face3( 4, 5, 6 ) );
        geom.faces.push( new THREE.Face3( 5, 6, 7 ) );
        var corner = 197/800.0;
        var corner2 = 601/800.0;
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 1),
                                    new THREE.Vector2(0, 0),
                                    new THREE.Vector2(corner, 1)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(0, 0),
                                    new THREE.Vector2(corner, 1),
                                    new THREE.Vector2(corner, 0)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(corner, 1),
                                    new THREE.Vector2(corner, 0),
                                    new THREE.Vector2(corner2, 1)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(corner, 0),
                                    new THREE.Vector2(corner2, 1),
                                    new THREE.Vector2(corner2, 0)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(corner2, 1),
                                    new THREE.Vector2(corner2, 0),
                                    new THREE.Vector2(1, 1)]);
        geom.faceVertexUvs[0].push([new THREE.Vector2(corner2, 0),
                                    new THREE.Vector2(1, 1),
                                    new THREE.Vector2(1, 0)]);
        var object = new THREE.Mesh( geom, texture );
        return object;
      }

      function drawWindow(x,y,z,x2,y2,z2)
      {
        //top bar
        scene.add(createBar(x,y,z,x2,y,z2,"metal"));

        //bottom bar
        scene.add(createBar(x,y2,z,x2,y2,z2,"metal"));

        //side1
        scene.add(createBar(x,y,z,x,y2,z,"metal"));

        //side2
        scene.add(createBar(x2,y,z2,x2,y2,z2,"metal"));

        var texture = new THREE.ImageUtils.loadTexture("window.png");
        var material = new THREE.MeshPhongMaterial({ map:texture, transparent : true, depthWrite: false});

        //window
        cubegeometry = new THREE.BoxGeometry(Math.abs(x-x2),Math.abs(y-y2),Math.abs(z-z2));
        cube = new THREE.Mesh(cubegeometry, material);
        cube.position.set((x+x2)/2,(y+y2)/2,(z+z2)/2);
        scene.add(cube);
      }

      function createBox(x,y,z,dx,dy,dz,yaw,str)
      {
        //depth,height,width
        var cubegeometry;
        if(yaw==0)
        {
          cubegeometry = new THREE.BoxGeometry(dx,dy,dz);
        }
        else
        {
          cubegeometry = new THREE.BoxGeometry(dz,dy,dx);
        }

        var cube = new THREE.Mesh(cubegeometry, textures[str]);
        cube.position.set(x, y, z);
        scene.add(cube);
      }

      var compass = 0;
      function key(event)
      {
        var dx = Math.sin(compass);
        var dz = Math.cos(compass);
        var dx2 = Math.sin(compass+(3.14/2));
        var dz2 = Math.cos(compass+(3.14/2));

        if(event.keyCode==37)//left
        {
          camera.position.z-=dz2;
          camera.position.x-=dx2;
        }
        else if(event.keyCode==39)//right
        {
          camera.position.z+=dz2;
          camera.position.x+=dx2;
        }
        else if(event.keyCode==38)//forward
        {
          camera.position.z-=dz;
          camera.position.x-=dx;
        }
        else if(event.keyCode==40)//backward
        {
          camera.position.z+=dz;
          camera.position.x+=dx;
        }
        else if(event.keyCode==65)//yaw left
        {//pitch up,yaw left,roll right
          camera.rotation.y+=3*3.14/180;
          compass+=3*3.14/180;
        }
        else if(event.keyCode==68)//yaw right
        {
          camera.rotation.y-=3*3.14/180;
          compass-=3*3.14/180;
        }
        else if(event.keyCode==83)//move down
        {
          camera.position.y-=1;
        }
        else if(event.keyCode==87)//move up
        {
          camera.position.y+=1;
        }
      }

      function other()
      {
        geom.faces.push( new THREE.Face3( 11, 12, 21) );
        geom.faces.push( new THREE.Face3( 11, 21, 20) );
        geom.faces.push( new THREE.Face3( 22, 23, 1) );
        geom.faces.push( new THREE.Face3( 23, 24, 1) );
        geom.faces.push( new THREE.Face3( 24, 1, 2) );
        geom.faces.push( new THREE.Face3( 24, 2, 25) );
        geom.faces.push( new THREE.Face3( 25, 2, 3) );
        geom.faces.push( new THREE.Face3( 25, 26, 3) );
        geom.faces.push( new THREE.Face3( 26, 3, 14) );
        geom.faces.push( new THREE.Face3( 15, 3, 14) );
        geom.faces.push( new THREE.Face3( 15, 3, 8) );
        geom.faces.push( new THREE.Face3( 15, 7, 8) );
        geom.faces.push( new THREE.Face3( 14, 13, 26) );
        geom.faces.push( new THREE.Face3( 13, 26, 27) );
        geom.faces.push( new THREE.Face3( 13, 27, 12) );
        geom.faces.push( new THREE.Face3( 27, 12, 20) );
        geom.faces.push( new THREE.Face3( 11, 17, 12) );
        geom.faces.push( new THREE.Face3( 17, 12, 13) );
        geom.faces.push( new THREE.Face3( 17, 13, 18) );
        geom.faces.push( new THREE.Face3( 13, 18, 14) );
        geom.faces.push( new THREE.Face3( 18, 14, 15) );
        geom.faces.push( new THREE.Face3( 18, 15, 19) );
        geom.faces.push( new THREE.Face3( 15, 19, 7) );
        geom.faces.push( new THREE.Face3( 19, 7, 16) );
        geom.faces.push( new THREE.Face3( 19, 16, 17) );
        geom.faces.push( new THREE.Face3( 19, 17, 18) );
        geom.faces.push( new THREE.Face3( 20, 21, 28) );
        geom.faces.push( new THREE.Face3( 21, 28, 22) );
        geom.faces.push( new THREE.Face3( 28, 22, 29) );
        geom.faces.push( new THREE.Face3( 22, 29, 23) );
        geom.faces.push( new THREE.Face3( 29, 23, 24) );
        geom.faces.push( new THREE.Face3( 29, 24, 30) );
        geom.faces.push( new THREE.Face3( 24, 30, 25) );
        geom.faces.push( new THREE.Face3( 30, 25, 26) );
        geom.faces.push( new THREE.Face3( 30, 26, 31) );
        geom.faces.push( new THREE.Face3( 26, 31, 27) );
        geom.faces.push( new THREE.Face3( 31, 27, 28) );
        geom.faces.push( new THREE.Face3( 27, 28, 20) );
        geom.faces.push( new THREE.Face3( 28, 29, 30) );
        geom.faces.push( new THREE.Face3( 29, 30, 31) );



        geom.faceVertexUvs[0].push([uv_11,uv_12,uv_21]);
        geom.faceVertexUvs[0].push([uv_11,uv_21,uv_20]);
        geom.faceVertexUvs[0].push([uv_22,uv_23,uv1]);
        geom.faceVertexUvs[0].push([uv_23,uv_24,uv1]);
        geom.faceVertexUvs[0].push([uv_24,uv1,uv2]);
        geom.faceVertexUvs[0].push([uv_24,uv2,uv_25]);
        geom.faceVertexUvs[0].push([uv_25,uv2,uv3]);
        geom.faceVertexUvs[0].push([uv_25,uv_26,uv3]);
        geom.faceVertexUvs[0].push([uv_26,uv3,uv_14]);
        geom.faceVertexUvs[0].push([uv_15,uv3,uv_14]);
        geom.faceVertexUvs[0].push([uv_15,uv3,uv_8]);
        geom.faceVertexUvs[0].push([uv_15,uv_7,uv_8]);
        geom.faceVertexUvs[0].push([uv_14,uv_13,uv_26]);
        geom.faceVertexUvs[0].push([uv_13,uv_26,uv_27]);
        geom.faceVertexUvs[0].push([uv_13,uv_27,uv_12]);
        geom.faceVertexUvs[0].push([uv_27,uv_12,uv_20]);
        geom.faceVertexUvs[0].push([uv_11,uv_17,uv_12]);
        geom.faceVertexUvs[0].push([uv_17,uv_12,uv_13]);
        geom.faceVertexUvs[0].push([uv_17,uv_13,uv_18]);
        geom.faceVertexUvs[0].push([uv_13,uv_18,uv_14]);
        geom.faceVertexUvs[0].push([uv_18,uv_14,uv_15]);
        geom.faceVertexUvs[0].push([uv_18,uv_15,uv_19]);
        geom.faceVertexUvs[0].push([uv_15,uv_19,uv_7]);
        geom.faceVertexUvs[0].push([uv_19,uv_7,uv_16]);
        geom.faceVertexUvs[0].push([uv_19,uv_16,uv_17]);
        geom.faceVertexUvs[0].push([uv_19,uv_17,uv_18]);
        geom.faceVertexUvs[0].push([uv_20,uv_21,uv_28]);
        geom.faceVertexUvs[0].push([uv_21,uv_28,uv_22]);
        geom.faceVertexUvs[0].push([uv_28,uv_22,uv_29]);
        geom.faceVertexUvs[0].push([uv_22,uv_29,uv_23]);
        geom.faceVertexUvs[0].push([uv_29,uv_23,uv_24]);
        geom.faceVertexUvs[0].push([uv_29,uv_24,uv_30]);
        geom.faceVertexUvs[0].push([uv_24,uv_30,uv_25]);
        geom.faceVertexUvs[0].push([uv_30,uv_25,uv_26]);
        geom.faceVertexUvs[0].push([uv_30,uv_26,uv_31]);
        geom.faceVertexUvs[0].push([uv_26,uv_31,uv_27]);
        geom.faceVertexUvs[0].push([uv_31,uv_27,uv_28]);
        geom.faceVertexUvs[0].push([uv_27,uv_28,uv_20]);
        geom.faceVertexUvs[0].push([uv_28,uv_29,uv_30]);
        geom.faceVertexUvs[0].push([uv_29,uv_30,uv_31]);
      }
    </script>
  </head>
  <body onload="load()">
  </body>
</html>
